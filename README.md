# Обход предупреждения браузера
<hr />

## Введение
При закрытии окна браузера вызываются функцию **onbeforeunload**, бразуер четко отслеживает вызов данной внутри функции. Функция в первую очередь предназначена для того чтобы пользователь случайно не закрыл вкладку с заполненными данными. Поэтому в конце выполнения функция выводит **confirm** с текстом полученным в результате выполнения функции:

```javascript
window.onbeforeunload = function (e) {
  return "Текст confirm'a"
};
```
В случаях, в том числе нашем когда данная функция не возвращает никакого текста, тогда **confirm** не вызывается, но функция  в любом случае отрабатывает

## Цель
Используя функцию **onbeforeunload** выполнить функцию открывающую эту же страницу в новой вкладке:
```javascript
window.open("index.html", "_blank");
```
Таким образом при попытке закрытия вкладки, сработает функция **onbeforeunload** и сразу же откроет вкладку заного. Создаться эффект при котором вкладку невозможно будет закрыть.

Но все еще будет возможность вернуться "назад", которую необходимо закрыть



## Блокировка функции "назад"
Сначала разберемся с кнопкой назад и что она делает -  возвращает пользователя на прошлую страницу в истории.

Можно ли заблокировать кнопку назад? - Нет

Такой возможности в данный момент браузер не предоставляет, но можно разобраться как браузер понимает куда нужно возвращаться. История посещений для функции назад храниться в:

```javascript
window.history.state
```
Можно ли ее подменить? В теории можно, но в данной ситуации я выбрал более простой и эффективный подход - ее заполнение. 

У ```window.history ``` есть прототип -> функция ```pushState```, которая заполняет историю новыми записями перед текущей страницей.
```javascript
for (let i = 0; i < 50; i++) {
    window.history.pushState({}, "", "/index.html");
}
```
 Проходясь циклом для засорения истории мы блокируем возможность вернуться назад для пользователя, ведь теперь прошлая страница **это текущая**


 ### Блокировка закрытия вкладки
 Бразуер не дает открывать новые окна из кода (появляется предупреждение об открытии всплывающего окна), если пользователь не совершил для этого какого-либо действия, одно из таких действий - ```click```

 При нажатии открывать новую вкладку нам не нужно и "заморозить" открытие новой вкладки до ее закрытия невозможно. В данном случае создается интервал с переодичность 100 раз в секунду после нажатия в любое место документа

 В интервале добавим проверку от внешней переменной ```tik```, если ```tik === true```, то мы открываем новую вкладку. Так как 

```javascript
window.open("index.html", "_blank");
```

вызывается из события ```click```, который бразуер не блокирует, то вкладка открывается без какого либо предупреждения.

Осталось только в событии **onbeforeunload** изменить значение переменной ```tik```
```javascript
    window.onbeforeunload = function (e) {
      tik = true;
    };
```
и при закрытии успевает отработать интервал на переоткрытие вкладки

## Дополнительно

Так же введена переменная ```stop``` и добавлен ```eventlistener``` для всех тэгов ```a``` на клик, который меняет значение ```stop``` на ```true```. У ```stop``` есть условие если ```stop === true```, то переоткрытия не происходит, это необходимо для передвижения внутри сайта без переоткрытия вкладки. 

Таким образом пользователь может спокойно передвигаться внутри сайта, но выйти с него для него не представляется возможным без полного закрытия браузера или остановки нажатий документа